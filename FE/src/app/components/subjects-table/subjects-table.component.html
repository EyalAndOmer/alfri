<div class="table-wrapper">
  <table mat-table [dataSource]="resolvedDataSource" aria-description="subject table">
    <ng-container matColumnDef="select" *ngIf="isSelectable()">
      <th mat-header-cell *matHeaderCellDef></th>
      <td mat-cell *matCellDef="let subject">
        <mat-checkbox
          (click)="$event.stopPropagation()"
          (change)="toggleSelection(subject)"
          (keyup.enter)="toggleSelection(subject)"
          [checked]="isSelected(subject)"
          [disabled]="isDisabled(subject)"
        ></mat-checkbox>
      </td>
    </ng-container>

    <ng-container matColumnDef="name">
      <th mat-header-cell *matHeaderCellDef>Názov</th>
      <td mat-cell *matCellDef="let subject">
        <a
          class="text-decoration-none"
          href="javascript:void(0)"
          (click)="navigateToSubjectDetail(subject.code)"
        >
          {{ subject.name }}
        </a>
      </td>
    </ng-container>

    <ng-container matColumnDef="code">
      <th mat-header-cell class="center" *matHeaderCellDef>Kód predmetu</th>
      <td mat-cell *matCellDef="let subject">{{ subject.code }}</td>
    </ng-container>

    <ng-container matColumnDef="abbreviation">
      <th mat-header-cell class="center" *matHeaderCellDef>Skratka predmetu</th>
      <td mat-cell *matCellDef="let subject">{{ subject.abbreviation }}</td>
    </ng-container>

    <ng-container matColumnDef="obligation">
      <th mat-header-cell class="center" *matHeaderCellDef>
        Povinnosť predmetu
      </th>
      <td mat-cell *matCellDef="let subject">{{ subject.obligation }}</td>
    </ng-container>

    <ng-container matColumnDef="recommendedYear">
      <th mat-header-cell class="center" *matHeaderCellDef>Odporúčaný rok</th>
      <td mat-cell *matCellDef="let subject">{{ subject.recommendedYear }}</td>
    </ng-container>

    <ng-container matColumnDef="semester">
      <th mat-header-cell class="center" *matHeaderCellDef>Semester</th>
      <td mat-cell *matCellDef="let subject">{{ subject.semester }}</td>
    </ng-container>

    <ng-container matColumnDef="empty" *ngIf="!resolvedDataSource.data?.length && !isLoading()">
      <td mat-cell colspan="7">No subjects are present</td>
    </ng-container>

    <!-- Skeleton rows when loading -->
    @if (isLoading()) {
      @for (_ of [1, 2, 3, 4, 5]; track $index) {
        <tr mat-row class="skeleton-row">
          @for (col of columnsToDisplay(); track col) {
            <td mat-cell>
              <div class="skeleton skeleton-text"></div>
            </td>
          }
        </tr>
      }
    } @else {
      <tr mat-header-row *matHeaderRowDef="columnsToDisplay(); sticky: true"></tr>
      <tr mat-row *matRowDef="let row; columns: columnsToDisplay(); trackBy: trackByCode"></tr>
    }
  </table>
</div>
@if (isPageable()) {
  <div>
    @if (isLoading()) {
      <mat-progress-bar mode="indeterminate"></mat-progress-bar>
    }
    <mat-paginator
      [length]="pageData().totalElements"
      [pageSize]="pageData().size"
      [pageIndex]="pageData().number"
      (page)="onPageChange($event)"
      [pageSizeOptions]="[5, 10, 100]"
    ></mat-paginator>
  </div>
}
