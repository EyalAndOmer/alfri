<mat-card>
  <mat-card-header>
    <mat-card-title> Report predmetov podľa známok </mat-card-title>
  </mat-card-header>

  <mat-card-content>
    <div class="row my-3">
      <div class="col-12 col-md-6">
        <mat-form-field
          appearance="outline"
          class="w-100"
          subscriptSizing="dynamic"
        >
          <mat-label>Zoradiť podľa</mat-label>
          <mat-select
            [(ngModel)]="sortCriteria"
            (selectionChange)="onSortChange()"
          >
            <mat-option value="lowestAverage">
              Najlepšia priemerná známka
            </mat-option>
            <mat-option value="highestAverage">
              Najhoršia priemerná známka
            </mat-option>
            <mat-option value="mostAGrades"> Najviac A </mat-option>
            <mat-option value="mostFXGrades"> Najviac FX </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>

    <div>
      <p>Zoradiť podľa:</p>
      <!--        (change)="onUserSelectionChange()"-->
      <mat-radio-group [(ngModel)]="sortCriteria">
        <mat-radio-button value="lowestAverage"
          >Najlepšia priemerná známka</mat-radio-button
        >
        <mat-radio-button value="highestAverage"
          >Najhoršia priemerná známka</mat-radio-button
        >
        <mat-radio-button value="mostAGrades">Najviac A</mat-radio-button>
        <mat-radio-button value="mostFXGrades">Najviac FX</mat-radio-button>
      </mat-radio-group>
    </div>
    @if (isLoading) {
      <div style="height: 4px">
        <mat-progress-bar mode="indeterminate"></mat-progress-bar>
      </div>
    } @else {
      <div style="height: 4px"></div>
    }

    <div class="table-wrapper overflow-x-scroll">
      <table mat-table [dataSource]="dataSource">
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>Názov</th>
          <td mat-cell *matCellDef="let subject">
            <a
              class="text-decoration-none"
              href="javascript:void(0)"
              (click)="navigateToSubjectDetail(subject.subject.code)"
            >
              {{ subject.subject.name }}
            </a>
          </td>
        </ng-container>

        <ng-container matColumnDef="code">
          <th mat-header-cell class="center" *matHeaderCellDef>Kód predmetu</th>
          <td mat-cell *matCellDef="let subject">{{ subject.subject.code }}</td>
        </ng-container>

        <ng-container matColumnDef="studentsCount">
          <th mat-header-cell class="center" *matHeaderCellDef>
            Počet študentov
          </th>
          <td mat-cell *matCellDef="let subject">
            {{ subject.studentsCount }}
          </td>
        </ng-container>

        <ng-container matColumnDef="averageScore">
          <th mat-header-cell class="center" *matHeaderCellDef>
            Priemerná známka
          </th>
          <td mat-cell *matCellDef="let subject">{{ subject.gradeAverage }}</td>
        </ng-container>

        <ng-container matColumnDef="gradeA">
          <th mat-header-cell class="center" *matHeaderCellDef>A</th>
          <td mat-cell *matCellDef="let subject">{{ subject.gradeA }} %</td>
        </ng-container>

        <ng-container matColumnDef="gradeB">
          <th mat-header-cell class="center" *matHeaderCellDef>B</th>
          <td mat-cell *matCellDef="let subject">{{ subject.gradeB }} %</td>
        </ng-container>

        <ng-container matColumnDef="gradeC">
          <th mat-header-cell class="center" *matHeaderCellDef>C</th>
          <td mat-cell *matCellDef="let subject">{{ subject.gradeC }} %</td>
        </ng-container>

        <ng-container matColumnDef="gradeD">
          <th mat-header-cell class="center" *matHeaderCellDef>D</th>
          <td mat-cell *matCellDef="let subject">{{ subject.gradeD }} %</td>
        </ng-container>

        <ng-container matColumnDef="gradeE">
          <th mat-header-cell class="center" *matHeaderCellDef>E</th>
          <td mat-cell *matCellDef="let subject">{{ subject.gradeE }} %</td>
        </ng-container>

        <ng-container matColumnDef="gradeFx">
          <th mat-header-cell class="center" *matHeaderCellDef>FX</th>
          <td mat-cell *matCellDef="let subject">{{ subject.gradeFx }} %</td>
        </ng-container>

        <tr
          mat-header-row
          *matHeaderRowDef="columnsToDisplay; sticky: true"
        ></tr>
        <tr mat-row *matRowDef="let row; columns: columnsToDisplay"></tr>
      </table>
    </div>

    <mat-paginator
      [pageSizeOptions]="[5, 10, 20, 50]"
      [pageSize]="10"
      showFirstLastButtons
      aria-label="Výber stránky"
    ></mat-paginator>
  </mat-card-content>
</mat-card>
