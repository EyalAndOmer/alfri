<div class="container">
  <mat-stepper #stepper [linear]="true" class="modern-stepper">
    <!-- Step 1: Select Subjects -->
    <mat-step [completed]="selectedSubjects().length > 0">
      <ng-template matStepLabel>Výber predmetov</ng-template>

      <mat-card class="mt-3">
        <mat-card-header>
          <mat-card-title>
            Výberom troch predmetov zobraz podobné predmety
          </mat-card-title>
        </mat-card-header>

        <mat-card-content>
          @if (isLoadingRecommendetSubjects()) {
            <mat-progress-bar mode="indeterminate"></mat-progress-bar>
          }

          <mat-form-field appearance="outline" class="w-100 my-2">
            <mat-label>Vyhľadať predmety</mat-label>
            <input
              matInput
              type="text"
              [ngModel]="searchTerm()"
              (ngModelChange)="onSearchChange($event)"
              placeholder="Zadajte názov predmetu..."
            />
            <mat-icon matSuffix>search</mat-icon>
          </mat-form-field>

          <app-generic-table
            class="overflow-x-scroll"
            [data]="allSubjectsData()"
            [config]="allSubjectsTableConfig"
            [loading]="isLoadingAllSubjects()"
            (pageChange)="onPageChangeAllSubjects($event)"
            (sortChange)="onSortChange($event)"
            (selectionChange)="onSelectionChange($event)"
          >
          </app-generic-table>
        </mat-card-content>
      </mat-card>

      <div class="mt-3 d-flex justify-content-end">
        <button
          mat-raised-button
          color="primary"
          (click)="getSimilarSubjects()"
          [disabled]="selectedSubjects().length === 0"
        >
          <mat-icon>search</mat-icon>
          Vyhľadať podobné predmety
        </button>
      </div>

      @if (isLoadingRecommendetSubjects()) {
        <mat-progress-bar mode="indeterminate" class="mt-2"></mat-progress-bar>
      }
    </mat-step>

    <!-- Step 2: Show Results -->
    <mat-step>
      <ng-template matStepLabel>Výsledky</ng-template>

      <div class="row m-0 p-0 mt-3">
        <!-- Left side: Selected Subjects -->
        <div class="col-12 col-md-6 mb-3 mb-md-0">
          <mat-card style="min-height: 400px" class="section-card">
            <mat-card-header>
              <mat-card-title class="d-flex align-items-center gap-2">
                <mat-icon class="text-primary">checklist</mat-icon>
                Vybrané predmety
                <span class="badge bg-primary ms-2">{{ selectedSubjects().length }}</span>
              </mat-card-title>
            </mat-card-header>

            <mat-card-content>
              @if (selectedSubjects().length > 0) {
                <app-generic-table
                  [data]="selectedSubjectsPageData()"
                  [config]="selectedSubjectsTableConfig"
                  [loading]="false"
                  (rowClick)="onRowClick($event.row)"
                >
                </app-generic-table>
              } @else {
                <div class="text-center text-muted p-3">
                  Žiadne vybrané predmety
                </div>
              }
            </mat-card-content>
          </mat-card>
        </div>

        <!-- Right side: Similar Subjects -->
        <div class="col-12 col-md-6">
          <mat-card style="min-height: 400px" class="section-card">
            <mat-card-header>
              <mat-card-title class="d-flex align-items-center gap-2">
                <mat-icon class="text-warning">auto_awesome</mat-icon>
                Podobné predmety
                <span class="badge bg-warning ms-2">{{
                  recommendedSubjectsPageDataComputed().content.length
                }}</span>
              </mat-card-title>
            </mat-card-header>

            <mat-card-content>
              @if (
                recommendedSubjectsPageDataComputed().content.length === 0 &&
                !isLoadingRecommendetSubjects()
              ) {
                <div class="text-center text-muted p-3">
                  Nenašli sa žiadne podobné predmety
                </div>
              } @else {
                <app-generic-table
                  [data]="recommendedSubjectsPageDataComputed()"
                  [config]="recommendedSubjectsTableConfig"
                  [loading]="isLoadingRecommendetSubjects()"
                  (rowClick)="onRowClick($event.row)"
                >
                </app-generic-table>
              }
            </mat-card-content>
          </mat-card>
        </div>
      </div>

      <div class="mt-3 d-flex justify-content-start">
        <button mat-raised-button matStepperPrevious>
          <mat-icon>arrow_back</mat-icon>
          Späť
        </button>
      </div>
    </mat-step>
  </mat-stepper>
</div>
