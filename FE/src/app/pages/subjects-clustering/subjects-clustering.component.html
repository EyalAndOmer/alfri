<div class="container-fluid m-0">
  <mat-stepper #stepper [linear]="true">
    <!-- Step 1: Select Subjects -->
    <mat-step [completed]="selectedSubjects().length > 0">
      <ng-template matStepLabel>Výber predmetov</ng-template>

      <mat-card class="mt-3">
        <mat-card-header>
          <mat-card-title>
            Výberom troch predmetov zobraz podobné predmety
          </mat-card-title>
        </mat-card-header>

        <mat-card-content>

          @if (isLoadingRecommendetSubjects()) {
            <mat-progress-bar mode="indeterminate"></mat-progress-bar>
          }

          <mat-form-field appearance="outline" class="w-100 my-2">
            <mat-label>Vyhľadať predmety</mat-label>
            <input
              matInput
              type="text"
              [(ngModel)]="searchTerm"
              (ngModelChange)="onSearchChange($event)"
              placeholder="Zadajte názov predmetu..."
            />
            <mat-icon matSuffix>search</mat-icon>
          </mat-form-field>

          <app-subjects-table
            [dataSourceInput]="dataSource"
            [pageData]="allSubjectsPageData"
            [isLoading]="isLoadingAllSubjects()"
            (pageChange)="onPageChangeAllSubjects($event)"
            [displayFullInfo]="false"
            [isSelectable]="true"
            [maxSelectableSubjects]="3"
            (selectedSubjects)="onSelectedSubjectsChanged($event)"
            (subjectDetailNavigate)="navigateToSubjectDetail($event)"
          >
          </app-subjects-table>
        </mat-card-content>
      </mat-card>

      <div class="mt-3 d-flex justify-content-end">
        <button
          mat-raised-button
          color="primary"
          (click)="getSimilarSubjects()"
          [disabled]="selectedSubjects().length === 0"
        >
          <mat-icon>search</mat-icon>
          Vyhľadať podobné predmety
        </button>
      </div>

      @if (isLoadingRecommendetSubjects()) {
        <mat-progress-bar mode="indeterminate" class="mt-2"></mat-progress-bar>
      }
    </mat-step>

    <!-- Step 2: Show Results -->
    <mat-step>
      <ng-template matStepLabel>Výsledky</ng-template>

      <div class="row m-0 p-0 mt-3">
        <!-- Left side: Selected Subjects -->
        <div class="col-12 col-md-6 mb-3 mb-md-0">
          <mat-card style="min-height: 400px;">
            <mat-card-header>
              <mat-card-title>
                Vybrané predmety ({{ selectedSubjects().length }})
              </mat-card-title>
            </mat-card-header>

            <mat-card-content>
              @if (selectedSubjects().length > 0) {
                <app-subjects-table
                  [pageData]="selectedSubjectsPageData()"
                  [isLoading]="false"
                  [displayFullInfo]="false"
                  [isPageable]="false"
                  [isScrollable]="true"
                  (subjectDetailNavigate)="navigateToSubjectDetail($event)"
                ></app-subjects-table>
              } @else {
                <div class="text-center text-muted p-3">
                  Žiadne vybrané predmety
                </div>
              }
            </mat-card-content>
          </mat-card>
        </div>

        <!-- Right side: Similar Subjects -->
        <div class="col-12 col-md-6">
          <mat-card style="min-height: 400px;">
            <mat-card-header>
              <mat-card-title>
                Podobné predmety ({{ recommendedSubjectsPageDataComputed().content.length }})
              </mat-card-title>
            </mat-card-header>

            <mat-card-content>
              @if (recommendedSubjectsPageDataComputed().content.length > 0 && !isLoadingRecommendetSubjects()) {
                <app-subjects-table
                  [pageData]="recommendedSubjectsPageDataComputed()"
                  [isLoading]="false"
                  [displayFullInfo]="false"
                  [isPageable]="false"
                  [isScrollable]="true"
                  (subjectDetailNavigate)="navigateToSubjectDetail($event)"
                ></app-subjects-table>
              } @else if (recommendedSubjectsPageDataComputed().content.length === 0 && !isLoadingRecommendetSubjects()) {
                <div class="text-center text-muted p-3">
                  Nenašli sa žiadne podobné predmety
                </div>
              } @else if (isLoadingRecommendetSubjects()) {
                <div class="text-center text-muted p-3">
                  Načítavam...
                </div>
              }
            </mat-card-content>
          </mat-card>
        </div>
      </div>

      <div class="mt-3 d-flex justify-content-start">
        <button mat-raised-button matStepperPrevious>
          <mat-icon>arrow_back</mat-icon>
          Späť
        </button>
      </div>
    </mat-step>
  </mat-stepper>
</div>
